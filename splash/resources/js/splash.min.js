function debounce(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:300,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=void 0;return 0===e?function(){t.apply(this,arguments)}:function(){var i=this,o=arguments;"SyntheticEvent"===o[0].constructor.name&&o[0].persist();var s=r&&!n;clearTimeout(n),n=setTimeout(function(){n=null,r||t.apply(i,o)},e),s&&t.apply(i,o)}}function t(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"div",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],n=document.createElement(t),i=!0,o=!1,s=void 0;try{for(var a,h=Object.entries(e)[Symbol.iterator]();!(i=(a=h.next()).done);i=!0){var l=a.value,c=slicedToArray(l,2),u=c[0],d=c[1];d&&((void 0===d?"undefined":_typeof(d))!==_typeof(function(){})?("style"===u&&(d=d.replace(/[\t\r\n]/g," ").trim()),n.setAttribute(u,d)):n.addEventListener(u,d))}}catch(t){o=!0,s=t}finally{try{!i&&h.return&&h.return()}finally{if(o)throw s}}return Array.isArray(r)||(r=[r]),r.map(function(t){if(t)try{n.appendChild(t)}catch(e){n.appendChild(document.createTextNode(t))}}),n}function inViewport(t){var e=t.getBoundingClientRect();return e.bottom>0&&e.right>0&&e.left<(window.innerWidth||document.documentElement.clientWidth)&&e.top<(window.innerHeight||document.documentElement.clientHeight)}Object.entries||(Object.entries=function(t){for(var e=Object.keys(t),r=e.length,n=new Array(r);r--;)n[r]=[e[r],t[e[r]]];return n}),function(t,e){"use strict";function r(t){this.time=t.time,this.target=t.target,this.rootBounds=t.rootBounds,this.boundingClientRect=t.boundingClientRect,this.intersectionRect=t.intersectionRect||{top:0,bottom:0,left:0,right:0,width:0,height:0},this.isIntersecting=!!t.intersectionRect;var e=this.boundingClientRect,r=e.width*e.height,n=this.intersectionRect,i=n.width*n.height;this.intersectionRatio=r?i/r:this.isIntersecting?1:0}function n(t,e){var r=e||{};if("function"!=typeof t)throw new Error("callback must be a function");if(r.root&&1!=r.root.nodeType)throw new Error("root must be an Element");this._checkForIntersections=o(this._checkForIntersections.bind(this),this.THROTTLE_TIMEOUT),this._callback=t,this._observationTargets=[],this._queuedEntries=[],this._rootMarginValues=this._parseRootMargin(r.rootMargin),this.thresholds=this._initThresholds(r.threshold),this.root=r.root||null,this.rootMargin=this._rootMarginValues.map(function(t){return t.value+t.unit}).join(" ")}function i(){return t.performance&&performance.now&&performance.now()}function o(t,e){var r=null;return function(){r||(r=setTimeout(function(){t(),r=null},e))}}function s(t,e,r,n){"function"==typeof t.addEventListener?t.addEventListener(e,r,n||!1):"function"==typeof t.attachEvent&&t.attachEvent("on"+e,r)}function a(t,e,r,n){"function"==typeof t.removeEventListener?t.removeEventListener(e,r,n||!1):"function"==typeof t.detatchEvent&&t.detatchEvent("on"+e,r)}function h(t,e){var r=Math.max(t.top,e.top),n=Math.min(t.bottom,e.bottom),i=Math.max(t.left,e.left),o=Math.min(t.right,e.right),s=o-i,a=n-r;return s>=0&&a>=0&&{top:r,bottom:n,left:i,right:o,width:s,height:a}}function l(t){var e;try{e=t.getBoundingClientRect()}catch(t){}return e?(e.width&&e.height||(e={top:e.top,right:e.right,bottom:e.bottom,left:e.left,width:e.right-e.left,height:e.bottom-e.top}),e):{top:0,bottom:0,left:0,right:0,width:0,height:0}}function c(t,e){for(var r=e;r;){if(r==t)return!0;r=u(r)}return!1}function u(t){var e=t.parentNode;return e&&11==e.nodeType&&e.host?e.host:e}if("IntersectionObserver"in t&&"IntersectionObserverEntry"in t&&"intersectionRatio"in t.IntersectionObserverEntry.prototype)"isIntersecting"in t.IntersectionObserverEntry.prototype||Object.defineProperty(t.IntersectionObserverEntry.prototype,"isIntersecting",{get:function(){return this.intersectionRatio>0}});else{var d=[];n.prototype.THROTTLE_TIMEOUT=100,n.prototype.POLL_INTERVAL=null,n.prototype.observe=function(t){if(!this._observationTargets.some(function(e){return e.element==t})){if(!t||1!=t.nodeType)throw new Error("target must be an Element");this._registerInstance(),this._observationTargets.push({element:t,entry:null}),this._monitorIntersections(),this._checkForIntersections()}},n.prototype.unobserve=function(t){this._observationTargets=this._observationTargets.filter(function(e){return e.element!=t}),this._observationTargets.length||(this._unmonitorIntersections(),this._unregisterInstance())},n.prototype.disconnect=function(){this._observationTargets=[],this._unmonitorIntersections(),this._unregisterInstance()},n.prototype.takeRecords=function(){var t=this._queuedEntries.slice();return this._queuedEntries=[],t},n.prototype._initThresholds=function(t){var e=t||[0];return Array.isArray(e)||(e=[e]),e.sort().filter(function(t,e,r){if("number"!=typeof t||isNaN(t)||t<0||t>1)throw new Error("threshold must be a number between 0 and 1 inclusively");return t!==r[e-1]})},n.prototype._parseRootMargin=function(t){var e=(t||"0px").split(/\s+/).map(function(t){var e=/^(-?\d*\.?\d+)(px|%)$/.exec(t);if(!e)throw new Error("rootMargin must be specified in pixels or percent");return{value:parseFloat(e[1]),unit:e[2]}});return e[1]=e[1]||e[0],e[2]=e[2]||e[0],e[3]=e[3]||e[1],e},n.prototype._monitorIntersections=function(){this._monitoringIntersections||(this._monitoringIntersections=!0,this.POLL_INTERVAL?this._monitoringInterval=setInterval(this._checkForIntersections,this.POLL_INTERVAL):(s(t,"resize",this._checkForIntersections,!0),s(e,"scroll",this._checkForIntersections,!0),"MutationObserver"in t&&(this._domObserver=new MutationObserver(this._checkForIntersections),this._domObserver.observe(e,{attributes:!0,childList:!0,characterData:!0,subtree:!0}))))},n.prototype._unmonitorIntersections=function(){this._monitoringIntersections&&(this._monitoringIntersections=!1,clearInterval(this._monitoringInterval),this._monitoringInterval=null,a(t,"resize",this._checkForIntersections,!0),a(e,"scroll",this._checkForIntersections,!0),this._domObserver&&(this._domObserver.disconnect(),this._domObserver=null))},n.prototype._checkForIntersections=function(){var t=this._rootIsInDom(),e=t?this._getRootRect():{top:0,bottom:0,left:0,right:0,width:0,height:0};this._observationTargets.forEach(function(n){var o=n.element,s=l(o),a=this._rootContainsTarget(o),h=n.entry,c=t&&a&&this._computeTargetAndRootIntersection(o,e),u=n.entry=new r({time:i(),target:o,boundingClientRect:s,rootBounds:e,intersectionRect:c});h?t&&a?this._hasCrossedThreshold(h,u)&&this._queuedEntries.push(u):h&&h.isIntersecting&&this._queuedEntries.push(u):this._queuedEntries.push(u)},this),this._queuedEntries.length&&this._callback(this.takeRecords(),this)},n.prototype._computeTargetAndRootIntersection=function(r,n){if("none"!=t.getComputedStyle(r).display){for(var i=l(r),o=u(r),s=!1;!s;){var a=null,c=1==o.nodeType?t.getComputedStyle(o):{};if("none"==c.display)return;if(o==this.root||o==e?(s=!0,a=n):o!=e.body&&o!=e.documentElement&&"visible"!=c.overflow&&(a=l(o)),a&&!(i=h(a,i)))break;o=u(o)}return i}},n.prototype._getRootRect=function(){var t;if(this.root)t=l(this.root);else{var r=e.documentElement,n=e.body;t={top:0,left:0,right:r.clientWidth||n.clientWidth,width:r.clientWidth||n.clientWidth,bottom:r.clientHeight||n.clientHeight,height:r.clientHeight||n.clientHeight}}return this._expandRectByRootMargin(t)},n.prototype._expandRectByRootMargin=function(t){var e=this._rootMarginValues.map(function(e,r){return"px"==e.unit?e.value:e.value*(r%2?t.width:t.height)/100}),r={top:t.top-e[0],right:t.right+e[1],bottom:t.bottom+e[2],left:t.left-e[3]};return r.width=r.right-r.left,r.height=r.bottom-r.top,r},n.prototype._hasCrossedThreshold=function(t,e){var r=t&&t.isIntersecting?t.intersectionRatio||0:-1,n=e.isIntersecting?e.intersectionRatio||0:-1;if(r!==n)for(var i=0;i<this.thresholds.length;i++){var o=this.thresholds[i];if(o==r||o==n||o<r!=o<n)return!0}},n.prototype._rootIsInDom=function(){return!this.root||c(e,this.root)},n.prototype._rootContainsTarget=function(t){return c(this.root||e,t)},n.prototype._registerInstance=function(){d.indexOf(this)<0&&d.push(this)},n.prototype._unregisterInstance=function(){var t=d.indexOf(this);-1!=t&&d.splice(t,1)},t.IntersectionObserver=n,t.IntersectionObserverEntry=r}}(window,document);var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},asyncGenerator=function(){function t(t){this.value=t}function e(e){function r(i,o){try{var s=e[i](o),a=s.value;a instanceof t?Promise.resolve(a.value).then(function(t){r("next",t)},function(t){r("throw",t)}):n(s.done?"return":"normal",s.value)}catch(t){n("throw",t)}}function n(t,e){switch(t){case"return":i.resolve({value:e,done:!0});break;case"throw":i.reject(e);break;default:i.resolve({value:e,done:!1})}(i=i.next)?r(i.key,i.arg):o=null}var i,o;this._invoke=function(t,e){return new Promise(function(n,s){var a={key:t,arg:e,resolve:n,reject:s,next:null};o?o=o.next=a:(i=o=a,r(t,e))})},"function"!=typeof e.return&&(this.return=void 0)}return"function"==typeof Symbol&&Symbol.asyncIterator&&(e.prototype[Symbol.asyncIterator]=function(){return this}),e.prototype.next=function(t){return this._invoke("next",t)},e.prototype.throw=function(t){return this._invoke("throw",t)},e.prototype.return=function(t){return this._invoke("return",t)},{wrap:function(t){return function(){return new e(t.apply(this,arguments))}},await:function(e){return new t(e)}}}(),classCallCheck=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},createClass=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),_extends=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},slicedToArray=function(){function t(t,e){var r=[],n=!0,i=!1,o=void 0;try{for(var s,a=t[Symbol.iterator]();!(n=(s=a.next()).done)&&(r.push(s.value),!e||r.length!==e);n=!0);}catch(t){i=!0,o=t}finally{try{!n&&a.return&&a.return()}finally{if(i)throw o}}return r}return function(e,r){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),toConsumableArray=function(t){if(Array.isArray(t)){for(var e=0,r=Array(t.length);e<t.length;e++)r[e]=t[e];return r}return Array.from(t)},slowLoading=["Any second now...","Almost there...","Just a moment...","Nearly got it...","Still searching for {query}...","So... {query}, huh?","{query} images coming right up..."],Splash=function(){function e(){var r=this;classCallCheck(this,e),this.grid=null,this.form=null,this.io=null,this.xhr=null,this.page=1,this.search="",this.totalPages=1,this.isQuerying=!1,this.shortest=[],this.watchers=[],this.onSearch=function(t){r.search=t.target.value,r.query(!0)},this.onLoad=function(t){t.target.removeEventListener("load",r.onLoad),t.target.parentNode.parentNode.classList.add("loaded"),t.target.style.paddingTop="0"},this.onObserve=function(t){t.forEach(function(t){t.isIntersecting&&("splashMore"!==t.target.id?t.target.dataset.watcher&&r.loadNextImage(t.target):r.page===r.totalPages||r.isQuerying||r.query())})},this.onDownload=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;t.preventDefault();for(var r=(e=e||t.target).dataset,n=r.id,i=r.image,o=r.author,s=r.authorUrl,a=r.color,h=e;!h.classList.contains("splash--grid-image");)h=h.parentNode;h.classList.add("downloading"),Craft.postActionRequest("splash/dl",{id:n,image:i,author:o,authorUrl:s,color:a},function(t,e){h.classList.remove("downloading"),"success"!==e||t.hasOwnProperty("error")?Craft.cp.displayError(t.hasOwnProperty("error")?t.error:"Failed to download image."):Craft.cp.displayNotice("Image downloaded successfully!")})},this.grid=document.getElementById("splashGrid"),this.form=document.getElementById("splashSearch"),this.io=new IntersectionObserver(this.onObserve),this.io.observe(document.getElementById("splashMore")),this.form.addEventListener("submit",function(t){return t.preventDefault()}),this.form.firstElementChild.addEventListener("input",debounce(this.onSearch,700)),this.query(!0),this.preview=t("div",{class:"splash--preview"}),document.body.appendChild(this.preview)}return createClass(e,[{key:"query",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e?(this.page=1,this.totalPages=1,this.grid.classList.add("searching")):r||this.page++,!(this.page>this.totalPages)){this.isQuerying=!0,this.xhr&&this.xhr.cancel(),this.xhr=new XMLHttpRequest,this.xhr.open("POST",Craft.getActionUrl("splash/un"),!0),this.xhr.setRequestHeader("X-Requested-With","XMLHttpRequest"),this.xhr.onload=function(){var n=t.xhr.status,i=t.xhr.responseText;if(t.xhr=null,e&&t.grid.classList.remove("searching"),t.isQuerying=!1,n<200||n>=400)Craft.cp.displayError(i);else{if(null===(i=JSON.parse(i)).images)return t.grid.dataset.loading=r?slowLoading[Math.floor(Math.random()*slowLoading.length)].replace("{query}",t.search):"Unsplash is taking a while...",void t.query(e,!0);t.totalPages=i.totalPages,t.populateResults(i.images)}};var n=new FormData;n.append(Craft.csrfTokenName,Craft.csrfTokenValue),n.append("page",this.page),n.append("query",encodeURI(this.search.trim())),this.xhr.send(n)}}},{key:"populateResults",value:function(t){var e=this;if(1===this.page&&(this.clearResults(),this.resetShortest()),t.forEach(function(t){var r=75;t.width&&t.height&&(r=t.height/t.width*100);var n=e.shortest.indexOf(Math.min.apply(Math,toConsumableArray(e.shortest)));e.shortest[n]+=r,e.grid.children[n].insertBefore(e.render(t),e.grid.children[n].lastElementChild)}),this.watchers.forEach(function(t){return e.loadNextImage(t)}),this.page===this.totalPages)for(var r=0;r<this.grid.children.length;r++)this.grid.children[r].removeChild(this.grid.children[r].lastElementChild)}},{key:"showPreview",value:function(t){for(var e=this;this.preview.firstElementChild;)this.preview.removeChild(this.preview.firstElementChild);this.preview.appendChild(this.render(t,function(){e.preview.classList.remove("open"),document.body.style.overflow="",document.body.parentNode.style.overflow=""})),this.preview.classList.add("open"),document.body.style.overflow="hidden",document.body.parentNode.style.overflow="hidden"}},{key:"clearResults",value:function(){for(var e=this.grid.children,r=0;r<e.length;r++){for(;e[r].firstElementChild;)e[r].removeChild(e[r].firstElementChild);this.watchers[r]||(this.watchers[r]=t("span"),this.watchers[r].dataset.watcher=!0,this.io.observe(this.watchers[r])),e[r].appendChild(this.watchers[r]),e[r].appendChild(t("div",{class:"splash--grid-loader"}))}}},{key:"resetShortest",value:function(){this.shortest=[];for(var t=0;t<this.grid.children.length;t++)this.shortest.push(0)}},{key:"loadNextImage",value:function(t){var e=t.nextElementSibling;if(e&&e.classList.contains("splash--grid-image")){var r=e.querySelector("img");r.setAttribute("src",r.dataset.src),r.setAttribute("alt",r.dataset.alt),t.parentNode.insertBefore(t,e.nextElementSibling),inViewport(t)&&this.loadNextImage(t)}}},{key:"render",value:function(e){var r=this,n=e.id,i=e.urls,o=e.user,s=e.width,a=e.height,h=e.links,l=e.color,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,u=75;s&&a&&(u=a/s*100);var d=null!==c;c||(c=this.showPreview.bind(this,arguments[0]));var f="?utm_source=Splash_For_Craft_CMS&utm_medium=referral&utm_campaign=api-credit";return t("div",{class:"splash--grid-image"+(d?" loaded":""),style:d?"":"\n\t\t\t\tpadding-top: "+u+"%;\n\t\t\t"},[t("div",{class:"splash--grid-image-top"},[t("a",{href:o.links.html+f,target:"_blank"},o.name),t("a",{id:d?"":n,class:"dl",href:h.download+f,target:"_blank","data-id":n,"data-image":h.download,"data-author":o.name,"data-author-url":o.links.html,"data-color":l,click:d?function(t){c(t),r.onDownload(t,document.getElementById(n))}:this.onDownload},"Download")]),t("div",{class:"splash--grid-image-img"+(s&&a&&s>a?"":" tall")},[t("img",_extends({},d?{src:i.small,alt:o.name}:{"data-src":i.small,"data-alt":o.name},{load:this.onLoad,click:c}))].concat(toConsumableArray(d?[t("img",{src:i.full,alt:o.name,click:c})]:[])))])}}]),e}();
//# sourceMappingURL=splash.min.js.map
